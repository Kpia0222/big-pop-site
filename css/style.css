/* ==========================================
   1. 基本設定 & リセット
   ========================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body, html {
    width: 100%;
    height: 100%;
    overflow: hidden; /* スクロール禁止 */
    background-color: #f90; /* 予備背景色 */
}

/* 全レイヤー共通：画面いっぱいに広げる */
#layer-bg, 
#layer-entrance, 
#layer-loading {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
}

/* ==========================================
   2. 背景レイヤー (最背面: z-index 1)
   ========================================== */
#layer-bg {
    z-index: 1;
    background-image: url('../images/background_entrance_01.JPG');
    background-size: cover;
    background-position: center;
}

/* ==========================================
   3. エントランスレイヤー (中層: z-index 2〜10)
   ========================================== */

/* --- ぐにゃぐにゃ線 (z-index: 2) --- */
#bubble-lines {
    position: fixed; /* absoluteからfixedに変更して確実に固定 */
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2; /* 背景(1)の上、バブル(10)の下 */
    pointer-events: none !important;
    overflow: visible; /* 枠外にはみ出しても描画されるようにする */
}

#bubble-lines path {
    fill: none !important;
    /* 太さを 7 → 1.5 または 2 に落として繊細にする */
    stroke-width: 4; 
    stroke-linecap: round;
    
    /* 線の透明度を下げて、背景に馴染ませる */
    opacity: 0.3;

    /* 光彩（ドロップシャドウ）を弱くして「ぼんやり」させる */
    filter: blur(0.5px) drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
    
    transition: opacity 0.5s ease;
}

.line-hidden {
    opacity: 0 !important;
    visibility: hidden;
}

/* --- メインコンテンツ容器 (z-index: 5) --- */
#layer-entrance {
    z-index: 5;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 2.5s ease, transform 2.5s cubic-bezier(0.2, 0, 0.2, 1);
}

/* 準備完了時（JSで制御） */
body.is-ready #layer-entrance {
    opacity: 1;
    transform: scale(1);
}

/* --- ロゴ設定 --- */
#main-logo {
    width: 200px;
    height: auto;
    z-index: 6;
    animation: liquid-look 0.8s ease-in-out infinite;
    filter: url(#liquid-filter);
}

@keyframes liquid-look {
    0%, 100% { filter: url(#liquid-filter) brightness(1.05); }
    50% { filter: url(#liquid-filter) brightness(1.15); }
}

/* --- シャボン玉共通 (z-index: 10) --- */
.bubble {
    position: absolute;
    z-index: 10; /* 線やロゴより前に配置 */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    pointer-events: auto !important; /* 確実にクリックに反応させる */
    user-select: none;
    opacity: 0;
    transition: opacity 2s ease;
    
    /* フォント・装飾 */
    color: white;
    font-family: 'Space Mono', monospace;
    font-weight: bold;
    font-size: 0.8rem;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(2px);
}

body.is-ready .bubble {
    opacity: 1;
}

/* シャボン玉のアニメーション */
.bubble {
    animation: 
        float-bubble 15s infinite ease-in-out,
        morph-bubble 10s infinite ease-in-out;
    transform-origin: center;
}

@keyframes morph-bubble {
    0%, 100% { border-radius: 50%; }
    25% { border-radius: 60% 40% 55% 45% / 45% 55% 45% 55%; }
    50% { border-radius: 45% 55% 40% 60% / 55% 45% 60% 40%; }
}

@keyframes float-bubble {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    50% { transform: translate(-10px, -30px) rotate(-2deg); }
}

/* --- シャボン玉 個別配置・色 (PC) --- */
.b1 { width: 280px; height: 280px; top: -2%; left: -2%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(220,130,130,0.3)); box-shadow: inset 0 10px 20px rgba(255,255,255,0.4); }
.b2 { width: 200px; height: 200px; top: 65%; left: 5%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(220,205,140,0.3)); box-shadow: inset 0 10px 20px rgba(255,255,255,0.4); }
.b3 { width: 240px; height: 240px; top: 5%; right: -3%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(150,180,225,0.3)); box-shadow: inset 0 10px 20px rgba(255,255,255,0.4); }
.b4 { width: 160px; height: 160px; top: 55%; right: 5%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(180,150,225,0.3)); box-shadow: inset 0 10px 20px rgba(255,255,255,0.4); }
.b5 { width: 220px; height: 220px; bottom: 5%; left: 45%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(170,205,150,0.3)); box-shadow: inset 0 10px 20px rgba(255,255,255,0.4); }

/* --- 弾けるアニメーション --- */
.bubble.popped {
    animation: bubble-pop 0.3s forwards ease-out !important;
    pointer-events: none;
}
@keyframes bubble-pop {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(2.5); opacity: 0; filter: brightness(3) blur(10px); }
}

/* ==========================================
   3a. 遷移レイヤー (中層: z-index 2〜10)
   ========================================== */
#content-area {
    position: relative;
    z-index: 300; /* overlayより手前 */
    color: white;
    text-align: center;
    opacity: 0;
    transition: opacity 1s ease;
}

#content-area.visible {
    opacity: 1;
}

.hidden { display: none; }

.back-button {
    position: relative;
    z-index: 2100;
    pointer-events: auto !important;
    cursor: pointer;
    margin-top: 50px;
    background: transparent;
    border: 1px solid white;
    color: white;
    padding: 10px 20px;
    cursor: pointer;
    font-family: 'Space Mono', monospace;
}

/* 巨大化（行き） */
.bubble.expanding {
    animation: bubble-expand 1.2s forwards cubic-bezier(0.4, 0, 0.2, 1) !important;
    z-index: 1000 !important;
    pointer-events: none;
}

/* 縮小（戻り） ★ここが動いていない可能性大 */
.bubble.shrinking {
    animation: bubble-shrink 1.2s forwards cubic-bezier(0.4, 0, 0.2, 1) !important;
    z-index: 1000 !important;
    pointer-events: none;
    display: flex !important; /* 消えてしまわないように固定 */
    opacity: 1 !important;
}

/* 巨大化：1から20へ */
@keyframes bubble-expand {
    0% { transform: scale(1); filter: blur(0px); }
    100% { transform: scale(20); filter: blur(10px); }
}

/* 縮小：20から1へ ★ここを確実にコピーしてください */
@keyframes bubble-shrink {
    0% { transform: scale(20); filter: blur(10px); }
    100% { transform: scale(1); filter: blur(0px); }
}

/* 巨大化中のバブルに付与するクラス */
.bubble.expanding {
    animation: bubble-expand 1.2s forwards cubic-bezier(0.4, 0, 0.2, 1) !important;
    z-index: 1000 !important; /* ロード画面をも超える最前面へ */
    pointer-events: none;
}

/* コンテンツのフェードイン用 */
#content-area {
    position: fixed; /* absoluteより安定します */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2000 !important; /* バブル(1000)より大きい値にする */
    width: 90%;
    max-width: 800px;
    text-align: center;
    pointer-events: auto; /* クリックを有効に */
}

#content-area.visible {
    opacity: 1;
}

/* ==========================================
   4. ロード画面レイヤー (最前面: z-index 100)
   ========================================== */
#layer-loading {
    z-index: 100;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.8);
    transition: opacity 1.5s ease;
}

body.is-ready #layer-loading {
    opacity: 0;
    pointer-events: none;
}

.loading-ui {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.loading-text {
    color: #fff;
    font-family: 'Space Mono', monospace;
    font-size: 1.2rem;
    letter-spacing: 0.5rem;
    margin-bottom: 20px;
}

.loading-bar-container {
    width: 200px;
    height: 1px;
    background: rgba(255, 255, 255, 0.3);
    overflow: hidden;
}

.loading-bar {
    width: 100%;
    height: 100%;
    background: #fff;
    transform: translateX(-100%);
    animation: loadMove 2s forwards linear;
}

@keyframes loadMove { to { transform: translateX(0); } }

/* ノイズ背景 */
.noise-layer { position: absolute; inset: 0; pointer-events: none; opacity: 0; z-index: -1; }
.grain { background-image: url("https://upload.wikimedia.org/wikipedia/commons/7/76/1k_Grain.png"); }
.static { background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJuIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC44NSIgbnVtT2N0YXZlcz0iNCIgc3RpdGNoVGlsZXM9InN0aXRjaCIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNuKSIgb3BhY2l0eT0iMC4yIi8+PC9zdmc+'); }

/* ==========================================
   5. レスポンシブ (スマホ対応)
   ========================================== */
@media screen and (max-width: 768px) {
    #main-logo { width: 130px; }
    .bubble span { font-size: 0.85rem; }
    /* スマホ用の配置 */
    .b1 { width: 130px; height: 130px; top: 5%; left: 5%; }
    .b2 { width: 100px; height: 100px; top: 15%; left: 65%; }
    .b3 { width: 120px; height: 120px; top: 40%; left: -5%; }
    .b4 { width: 100px; height: 100px; top: 50%; left: 70%; }
    .b5 { width: 110px; height: 110px; top: 75%; left: 35%; }
}