/* ==========================================
   1. 基本設定 & リセット
   ========================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* 画面の高さ（ツールバーを除いた正確な数値） */
    --vh: 1svh; 
}

body, html {
    width: 100%;
    /* 100svh = モバイルブラウザのバーを除いた100%の高さ */
    height: 100svh; 
    overflow: hidden;
    background-color: #000;
}

/* ==========================================
   2. 各レイヤーの重なり (z-index)
   ========================================== */
/* 数字が大きいほど手前に表示されます */
#layer-bg       { z-index: 1; }    /* 背景画像 */
#bubble-lines   { z-index: 2; }    /* バブルを繋ぐ線 */
#layer-entrance { z-index: 5; }    /* ロゴとバブルの層 */
#layer-loading  { z-index: 100; }  /* ロード画面（最優先で見せる） */
#content-area   { z-index: 2000; } /* ページ内容 */
.sub-bubble-container { z-index: 4000; } /* SNSリンク（常に最前面） */

/* ==========================================
   3. 背景・共通レイヤー設定
   ========================================== */
#layer-bg,
#layer-entrance,
#layer-loading {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
}

#layer-bg {
    background-image: url('../images/background_entrance_01.JPG');
    background-size: cover;
    background-position: center;
    background-color: rgba(0, 0, 0, 0.04);
    background-blend-mode: darken;
    transition: filter 1.5s ease;
}

/* メニューが開いた時、背景を暗くボカす */
body.is-menu-open #layer-bg {
    filter: brightness(0.4) blur(5px);
}

/* ==========================================
   4. 中央ロゴ設定
   ========================================== */
#layer-entrance {
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 2s ease, transform 2s cubic-bezier(0.2, 0, 0.2, 1);
    pointer-events: none; /* 下にあるバブルのクリックを邪魔しない */
}

body.is-ready #layer-entrance {
    opacity: 1;
    transform: scale(1);
}

#main-logo {
    position: absolute;
    /* 見切れ防止：画面中央から計算 */
    top: 55%; 
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    max-width: 40vw; /* 画面の幅が狭い時にロゴがはみ出ないように制限 */
    height: auto;
    filter: url(#liquid-filter) url(#corona-filter);
    border-radius: 50%;
    animation: 
        liquid-look 0.8s ease-in-out infinite,
        logo-corona-pulse 4s infinite ease-in-out alternate;
    transition: opacity 0.8s ease;
}

/* ロゴのアニメーション：うねりと拍動 */
@keyframes liquid-look {
    0%, 100% { filter: url(#liquid-filter) url(#corona-filter) brightness(1.05); }
    50% { filter: url(#liquid-filter) url(#corona-filter) brightness(1.15); }
}
@keyframes logo-corona-pulse {
    0% { box-shadow: 0 0 30px 5px rgba(255, 255, 255, 0.1); transform: translate(-50%, -50%) scale(1); }
    100% { box-shadow: 0 0 60px 15px rgba(255, 255, 255, 0.2); transform: translate(-50%, -50%) scale(1.02); }
}

/* ==========================================
   5. メインバブル設定
   ========================================== */
.bubble {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    pointer-events: auto !important; /* 常にクリック可能にする */
    user-select: none;
    opacity: 0;
    color: white;
    font-family: 'Space Mono', monospace;
    font-weight: bold;
    backdrop-filter: blur(2px);
    border-radius: 50% !important;
    filter: url(#corona-filter);
    transition: transform 1s, opacity 1s, filter 1s, visibility 1.5s;
    animation: 
        float-bubble 15s infinite ease-in-out, 
        corona-pulse 4s infinite ease-in-out alternate;
}

body.is-ready .bubble { opacity: 1; }

/* ページ切り替え中やメニュー表示中は、バブルのクリックを無効化 */
body.is-switching .bubble,
body.is-menu-open .bubble {
    pointer-events: none !important;
}

/* --- 個別配置 (PC用) --- */
/* top/bottomを画面の端からではなく、少し内側に設定して見切れを防止 */
.bubble.b5 { --init-size: 180px; --bg-color: #9933ff; width: var(--init-size); height: var(--init-size); top: 10svh; left: 50%; transform: translateX(-50%); background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(170, 205, 150, 0.5)); }
.bubble.b1 { --init-size: 240px; --bg-color: #ffcc00; width: var(--init-size); height: var(--init-size); top: 15svh; left: 15%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(220, 130, 130, 0.5)); }
.bubble.b2 { --init-size: 180px; --bg-color: #ff3366; width: var(--init-size); height: var(--init-size); top: 20svh; right: 10%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(220, 205, 140, 0.5)); }
.bubble.b3 { --init-size: 220px; --bg-color: #00ffcc; width: var(--init-size); height: var(--init-size); bottom: 15svh; left: 12%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(150, 180, 225, 0.5)); }
.bubble.b4 { --init-size: 160px; --bg-color: #3366ff; width: var(--init-size); height: var(--init-size); bottom: 18svh; right: 12%; background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(180, 150, 225, 0.5)); }

/* ==========================================
   6. ページ内容 (Content Area)
   ========================================== */
#content-area {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90%; 
    max-width: 800px;
    /* スマホで文字が溢れないように、中身だけスクロール可能にする */
    max-height: 80svh;
    overflow-y: auto;
    text-align: center;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.6s ease-out;
}

#content-area.visible { 
    opacity: 1;
    pointer-events: auto; /* ボタンやテキストを触れるようにする */
}

.back-button { 
    display: inline-block !important; 
    background: transparent; 
    border: 1px solid white; 
    color: white; 
    padding: 12px 24px; 
    margin-top: 20px;
    cursor: pointer; 
    font-family: 'Space Mono', monospace; 
    transition: 0.3s;
}

/* ==========================================
   7. SNSリンク (Sub Bubbles)
   ========================================== */
.sub-bubble-container {
    position: fixed; 
    bottom: 3svh; /* 画面下部から3%の位置に固定 */
    left: 50%; 
    transform: translateX(-50%);
    display: flex; 
    gap: 15px;
    pointer-events: auto !important; /* 常に反応するように強制 */
}

.sub-bubble {
    width: 45px; height: 45px; 
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    text-decoration: none;
    color: white;
    font-family: 'Space Mono', monospace; font-size: 0.6rem;
    background: rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(4px);
    filter: url(#corona-filter);
    transition: 0.3s;
    opacity: 0;
}

body.is-ready .sub-bubble { opacity: 1; }

/* 修正点：メニュー表示中もSNSリンクを消さない */
body.is-menu-open .sub-bubble {
    opacity: 1 !important;
    pointer-events: auto !important;
}

/* ==========================================
   8. スマホ・タブレット用調整
   ========================================== */
@media screen and (max-width: 1024px) {
    /* iPad / MacBook 等での見切れ対策 */
    .bubble { scale: 0.85; }
    #main-logo { top: 52%; width: 160px; }
}

@media screen and (max-width: 768px) {
    /* iPhone 等のスマホ調整 */
    #main-logo { top: 50%; width: 120px; }
    
    .bubble { --init-size: 100px !important; }
    
    /* スマホでは重ならないよう位置を再調整 */
    .bubble.b5 { top: 12svh; } 
    .bubble.b1 { top: 22svh; left: 5%; } 
    .bubble.b2 { top: 25svh; right: 5%; } 
    .bubble.b3 { bottom: 22svh; left: 5%; }
    .bubble.b4 { bottom: 22svh; right: 5%; }

    #inner-content h1 { font-size: 2rem !important; }
}